document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("chat-body"),t=document.getElementById("chat-input"),n=document.getElementById("send-btn");document.getElementById("voice-btn");let i=document.getElementById("chat-widget"),l=document.getElementById("chat-circle"),s=document.getElementById("close-chat"),r=new URLSearchParams(window.location.search).get("backendUrl");function d(){return document.getElementById("session-data").getAttribute("data-session-id")}function a(e){e.trim()&&c(e,"test")}function c(e,n){let i=d();if(!e.trim())return;null!=n||""==n||u("You",e);let l={input:e,sessionId:i};console.log(l),fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(e=>e.json()).then(e=>{let t=o(e.response).replace(/\n/g,"<br>");u("Bot",t)}).catch(()=>u("Bot","Error communicating with server.")),t.value=""}function o(e){let t=e.split(/([\u{1F300}-\u{1FAFF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}])/gu).filter(Boolean),n=t.shift().trim()||"";for(let i=0;i<t.length;i+=2)n+=`${t[i]} ${t[i+1]?t[i+1].trim():""}
`;return n.trim()}function u(t,n){let i=document.createElement("div");i.innerHTML=`<strong>${t}:</strong> ${n}`,i.style.padding="5px",e.appendChild(i),e.scrollTop=e.scrollHeight}l.addEventListener("click",()=>{i.classList.add("active"),l.style.display="none",a("hi")}),s.addEventListener("click",()=>{i.classList.remove("active"),setTimeout(()=>l.style.display="flex",300)}),n.addEventListener("click",()=>c(t.value)),t.addEventListener("keypress",e=>{"Enter"===e.key&&c(t.value)})});